// Функция для показа прогресса загрузки
function showProgress(filename, loaded, total) {
  const statusEl = document.getElementById('status');
  const percent = total ? Math.round((loaded / total) * 100) : 0;
  
  statusEl.innerHTML = `
    <div>⏳ Загрузка: ${filename}</div>
    <div class="progress-container">
      <div class="progress-bar" style="width: ${percent}%"></div>
    </div>
    <div>${loaded} / ${total} байт (${percent}%)</div>
  `;
}

// Модифицируйте загрузку аудио
const audioBlob = await fetch(audioUrl).then(r => {
  if (!r.ok) throw new Error(`Аудио не найдено: ${r.status} ${r.statusText}`);
  
  const reader = r.body.getReader();
  const contentLength = +r.headers.get('Content-Length');
  let receivedLength = 0;
  const chunks = [];
  
  return new ReadableStream({
    start(controller) {
      function pump() {
        return reader.read().then(({ done, value }) => {
          if (done) {
            controller.close();
            return new Blob(chunks);
          }
          
          chunks.push(value);
          receivedLength += value.length;
          showProgress(filename, receivedLength, contentLength);
          
          controller.enqueue(value);
          return pump();
        });
      }
      return pump();
    }
  }).then(stream => new Response(stream)).then(response => response.blob());
});